<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Introdução à acessibilidade urbana - 4  Dados GTFS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>
<script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><script src="site_libs/clipboard/clipboard.min.js"></script><script src="site_libs/quarto-search/autocomplete.umd.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><meta name="quarto:offset" content="./">
<link href="./5_gtfstools.html" rel="next">
<link href="./s3_dados_tp.html" rel="prev">
<link href="./images/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YVERJQF9PJ"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YVERJQF9PJ', { 'anonymize_ip': true});
</script><meta property="og:title" content="Introdução à acessibilidade urbana - 4  Dados GTFS">
<meta property="og:description" content="">
<meta property="og:image" content="https://ipeagit.github.io/intro_access_book/pt/images/gtfs_scheme.png">
<meta property="og:site-name" content="Introdução à acessibilidade urbana">
<meta property="og:image:height" content="1950">
<meta property="og:image:width" content="2475">
<meta name="twitter:title" content="Introdução à acessibilidade urbana - 4  Dados GTFS">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://ipeagit.github.io/intro_access_book/pt/images/gtfs_scheme.png">
<meta name="twitter:image-height" content="1950">
<meta name="twitter:image-width" content="2475">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb">
<li class="breadcrumb-item"><a href="./s3_dados_tp.html">SEÇÃO 3: Dados de transporte público</a></li>
<li class="breadcrumb-item"><a href="./4_dados_gtfs.html"><span class="chapter-number">4</span>  <span class="chapter-title">Dados GTFS</span></a></li>
</ol></nav><a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introdução à acessibilidade urbana</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://repositorio.ipea.gov.br/bitstream/11058/12264/1/Introducao_a_acessibilidade_urbana.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-download"></i></a>
    <a href="https://github.com/ipeaGIT/intro_access_book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Alternar modo escuro"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Apresentação</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEÇÃO 1: Introdução à acessibilidade urbana</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_conceito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>  <span class="chapter-title">O que é acessibilidade?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_indicadores.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>  <span class="chapter-title">Medidas de acessibilidade</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s2_calculo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEÇÃO 2: Como calcular acessibilidade urbana</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_calculando_acesso.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>  <span class="chapter-title">Calculando estimativas de acessibilidade em R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s3_dados_tp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEÇÃO 3: Dados de transporte público</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_dados_gtfs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>  <span class="chapter-title">Dados GTFS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_gtfstools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>  <span class="chapter-title">Manipulação e visualização de dados GTFS</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s4_avaliacao_impacto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEÇÃO 4: Avaliação de impacto de projetos de transporte</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_cenarios_transporte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>  <span class="chapter-title">Comparando a acessibilidade entre dois cenários de transporte</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./s5_dados_aop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEÇÃO 5: Dados do Projeto Acesso a Oportunidades</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_aopdata_populacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>  <span class="chapter-title">Dados de população e socioeconômicos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8_aopdata_uso_solo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>  <span class="chapter-title">Dados de distribuição espacial de oportunidades</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9_aopdata_acessibilidade.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>  <span class="chapter-title">Estimativas de acessibilidade</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências bibliográficas</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Índice</h2>
   
  <ul>
<li>
<a href="#estrutura-de-arquivos-gtfs" id="toc-estrutura-de-arquivos-gtfs" class="nav-link active" data-scroll-target="#estrutura-de-arquivos-gtfs"><span class="header-section-number">4.1</span> Estrutura de arquivos GTFS</a>
  <ul class="collapse">
<li><a href="#agency.txt" id="toc-agency.txt" class="nav-link" data-scroll-target="#agency.txt"><span class="header-section-number">4.1.1</span> agency.txt</a></li>
  <li><a href="#stops.txt" id="toc-stops.txt" class="nav-link" data-scroll-target="#stops.txt"><span class="header-section-number">4.1.2</span> stops.txt</a></li>
  <li><a href="#routes.txt" id="toc-routes.txt" class="nav-link" data-scroll-target="#routes.txt"><span class="header-section-number">4.1.3</span> routes.txt</a></li>
  <li><a href="#trips.txt" id="toc-trips.txt" class="nav-link" data-scroll-target="#trips.txt"><span class="header-section-number">4.1.4</span> trips.txt</a></li>
  <li><a href="#calendar.txt" id="toc-calendar.txt" class="nav-link" data-scroll-target="#calendar.txt"><span class="header-section-number">4.1.5</span> calendar.txt</a></li>
  <li><a href="#shapes.txt" id="toc-shapes.txt" class="nav-link" data-scroll-target="#shapes.txt"><span class="header-section-number">4.1.6</span> shapes.txt</a></li>
  <li><a href="#stop_times.txt" id="toc-stop_times.txt" class="nav-link" data-scroll-target="#stop_times.txt"><span class="header-section-number">4.1.7</span> stop_times.txt</a></li>
  <li><a href="#frequencies.txt" id="toc-frequencies.txt" class="nav-link" data-scroll-target="#frequencies.txt"><span class="header-section-number">4.1.8</span> frequencies.txt</a></li>
  </ul>
</li>
  <li><a href="#onde-encontrar-dados-gtfs-de-cidades-brasileiras" id="toc-onde-encontrar-dados-gtfs-de-cidades-brasileiras" class="nav-link" data-scroll-target="#onde-encontrar-dados-gtfs-de-cidades-brasileiras"><span class="header-section-number">4.2</span> Onde encontrar dados GTFS de cidades brasileiras</a></li>
  </ul>
<div class="toc-actions">
<div><i class="bi bi-github"></i></div>
<div class="action-links"><p><a href="https://github.com/ipeaGIT/intro_access_book/edit/main/4_dados_gtfs.qmd" class="toc-action">Editar essa página</a></p></div>
</div></nav><a href="../4_dados_gtfs.en.html">Read in English</a>
</div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-4_dados_gtfs" class="quarto-section-identifier"><span class="chapter-number">4</span>  <span class="chapter-title">Dados GTFS</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>O formato GTFS é uma especificação aberta e colaborativa que visa descrever os principais componentes de uma rede de transporte público. Originalmente criada em meados dos anos 2000 por uma parceria entre Google e TriMet, a agência de transporte de Portland, em Oregon, nos Estados Unidos, a especificação hoje é utilizada por agências de transporte em milhares de cidades, espalhadas por todos os continentes do globo <span class="citation" data-cites="mchugh2013pioneering">(<a href="references.html#ref-mchugh2013pioneering" role="doc-biblioref">McHugh 2013</a>)</span>. Atualmente, essa especificação é dividida em dois componentes distintos:</p>
<ul>
<li>GTFS <em>Schedule</em>, ou GTFS <em>Static</em>, que contém o cronograma planejado de linhas de transporte público, informações sobre suas tarifas e informações espaciais sobre os seus itinerários; e</li>
<li>GTFS <em>Realtime</em>, que contém informações de localização de veículos em tempo real e alertas de possíveis atrasos, de mudanças de percurso e de eventos que possam interferir no cronograma planejado.</li>
</ul>
<p>Ao longo desta seção, focaremos no formato <strong>GTFS <em>Schedule</em></strong>, por ser o mais amplamente utilizado por agências de transporte e em análises de acessibilidade<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Por ser uma especificação aberta e colaborativa, o formato GTFS tenta abarcar em sua definição um grande número de usos distintos que agências de transporte e desenvolvedores de ferramentas possam lhe dar. No entanto, agências e <em>softwares</em> podem ainda assim depender de informações que não constem na especificação oficial. Surgem, dessa forma, <a href="https://gtfs.org/extensions/">extensões</a> da especificação, algumas das quais podem eventualmente se tornar parte da especificação oficial, caso isso seja aceito pela comunidade. Nesta seção, focaremos em um subconjunto de informações presentes no formato GTFS <em>Schedule</em> “puro”, e, portanto, não cobriremos suas extensões.</p>
<section id="estrutura-de-arquivos-gtfs" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="estrutura-de-arquivos-gtfs">
<span class="header-section-number">4.1</span> Estrutura de arquivos GTFS</h2>
<p>Arquivos no formato GTFS <em>Schedule</em> (daqui em diante chamado apenas de GTFS) também são conhecidos pela denominação <em>feed</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Um <em>feed</em> é nada mais do que um arquivo comprimido em formato <code>.zip</code> que contém um conjunto de tabelas, salvas em formato <code>.txt</code>, com algumas informações sobre a rede de transporte público (localização das paradas, frequências das viagens, traçado das rotas, entre outras). Como em uma base de dados relacional, as tabelas de um <em>feed</em> possuem colunas-chaves que permitem vincular os dados de rotas, viagens e tabelas de horários entre si. O esquema geral do formato GTFS é apresentado na <a href="#fig-scheme">Figura <span>4.1</span></a>, que mostra algumas das principais tabelas que compõem a especificação e destaca como elas se relacionam a partir de suas colunas-chaves.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scheme" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/gtfs_scheme.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figura 4.1: Esquema do formato GTFS. Fonte: <span class="citation" data-cites="pereira2022exploringa">Pereira, Andrade, e Vieira (<a href="references.html#ref-pereira2022exploringa" role="doc-biblioref">2022</a>)</span></figcaption></figure>
</div>
</div>
</div>
<p>Ao todo, 22 tabelas compõem o formato GTFS<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Nem todas, no entanto, devem estar obrigatoriamente presentes para que um <em>feed</em> seja considerado válido, sendo consideradas, portanto, opcionais. A especificação classifica cada tabela conforme sua obrigatoriedade em três possíveis categorias: obrigatórias, opcionais e condicionalmente obrigatórias (quando a obrigatoriedade de uma tabela depende da existência de uma determinada tabela, coluna ou valor). Para fins de simplicidade, neste livro consideraremos apenas as duas primeiras categorias e faremos comentários quanto à obrigatoriedade de cada tabela quando apropriado. Dessa forma, as tabelas ficam classificadas conforme a seguir.</p>
<ol type="1">
<li>
<strong>Obrigatórias</strong>: <code>agency.txt</code>; <code>stops.txt</code>; <code>routes.txt</code>; <code>trips.txt</code>; <code>stop_times.txt</code>; <code>calendar.txt</code>.</li>
<li>
<strong>Opcionais</strong>: <code>calendar_dates.txt</code>; <code>fare_attributes.txt</code>; <code>fare_rules.txt</code>; <code>fare_products.txt</code>; <code>fare_leg_rules.txt</code>; <code>fare_transfer_rules.txt</code>; <code>areas.txt</code>; <code>stop_areas.txt</code>; <code>shapes.txt</code>; <code>frequencies.txt</code>; <code>transfers.txt</code>; <code>pathways.txt</code>; <code>levels.txt</code>; <code>translations.txt</code>; <code>feed_info.txt</code>; <code>attributions.txt</code>.</li>
</ol>
<p>Ao longo desta seção, aprenderemos sobre a estrutura básica de um arquivo GTFS e das tabelas que o compõem. Portanto, vamos olhar apenas para as tabelas obrigatórias e para as tabelas opcionais mais frequentemente utilizadas por produtores e consumidores desses arquivos<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<p>Na demonstração que será feita aqui, utilizaremos um subconjunto de dados provenientes do <em>feed</em> da cidade de São Paulo criado pela São Paulo Transporte (SPTrans)<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> e baixado em outubro de 2019. O <em>feed</em> contém as seis tabelas obrigatórias e mais duas tabelas opcionais bastante utilizadas, a <code>shapes.txt</code> e a <code>frequencies.txt</code>, o que permite uma boa visão geral sobre o formato GTFS.</p>
<section id="agency.txt" class="level3" data-number="4.1.1"><h3 data-number="4.1.1" class="anchored" data-anchor-id="agency.txt">
<span class="header-section-number">4.1.1</span> agency.txt</h3>
<p>Arquivo utilizado para descrever as operadoras de transporte que atuam no sistema descrito pelo arquivo GTFS. Embora o termo <em>agency</em> (agência) seja usado em lugar de <em>operators</em> (operadoras), por exemplo, fica a cargo do produtor do <em>feed</em> definir quais instituições serão listadas na tabela.</p>
<p>Por exemplo: múltiplas concessionárias de ônibus atuam em um determinado local, mas todo o planejamento de cronograma e de tarifa é realizado por uma única instituição, em geral uma secretaria de transporte ou empresa pública específica. Essa instituição é também entendida pelos usuários do sistema como a operadora, de fato. Nesse caso, devemos listar a instituição responsável pelo planejamento na tabela.</p>
<p>Agora, imagine um sistema em que a agência de transporte público local transfere a responsabilidade da operação de um sistema multimodal a diversas empresas, por meio de concessões. Cada uma dessas empresas é responsável pelo planejamento de cronogramas e tarifas dos modos que operam, desde que sejam seguidos determinados parâmetros preestabelecidos em contrato. Sendo assim, devemos listar as operadoras (concessionárias) na tabela, e não a agência de transporte público em si.</p>
<p>A <a href="#tbl-agency">Tabela <span>4.1</span></a> mostra o arquivo <code>agency.txt</code> do <em>feed</em> da SPTrans. Como podemos ver, os responsáveis pelo <em>feed</em> optaram por listar a própria empresa no arquivo, e não as concessionárias que operam os ônibus e o metrô da cidade.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-agency" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.1: Exemplo de arquivo <code>agency.txt</code>. Fonte: SPTrans</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 44%">
<col style="width: 19%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">agency_id</th>
<th style="text-align: left;">agency_name</th>
<th style="text-align: left;">agency_url</th>
<th style="text-align: left;">agency_timezone</th>
<th style="text-align: left;">agency_lang</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">SPTRANS</td>
<td style="text-align: left;">http://www.sptrans.com.br/?versao=011019</td>
<td style="text-align: left;">America/Sao_Paulo</td>
<td style="text-align: left;">pt</td>
</tr></tbody>
</table>
</div>
</div>
</div>
<p>É necessário notar que, embora estejamos apresentando o <code>agency.txt</code> em formato de tabela, o arquivo deve ser formatado como se fosse salvo em formato <code>.csv</code>. Ou seja, os valores de cada célula da tabela devem ser separados por vírgulas, e cada linha da tabela deve constar em uma linha no arquivo. A <a href="#tbl-agency">Tabela <span>4.1</span></a>, por exemplo, é definida da seguinte forma:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>agency_id,agency_name,agency_url,agency_timezone,agency_lang
1,SPTRANS,http://www.sptrans.com.br/?versao=011019,America/Sao_Paulo,pt </code></pre>
</div>
</div>
<p>Por uma questão de comunicação e interpretação dos dados, apresentaremos os exemplos em formato de tabela. É importante ter em mente, porém, que essas tabelas são organizadas como mostrado anteriormente.</p>
</section><section id="stops.txt" class="level3" data-number="4.1.2"><h3 data-number="4.1.2" class="anchored" data-anchor-id="stops.txt">
<span class="header-section-number">4.1.2</span> stops.txt</h3>
<p>Arquivo usado para descrever as paradas de transporte público que compõem o sistema. Os pontos listados neste arquivo podem fazer menção a paradas mais simples (como pontos de ônibus), estações, plataformas, entradas e saídas de estações etc. A <a href="#tbl-stops">Tabela <span>4.2</span></a> mostra o <code>stops.txt</code> do <em>feed</em> da SPTrans.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-stops" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.2: Exemplo de arquivo <code>stops.txt</code>. Fonte: SPTrans</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 16%">
<col style="width: 61%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">stop_id</th>
<th style="text-align: left;">stop_name</th>
<th style="text-align: left;">stop_desc</th>
<th style="text-align: right;">stop_lat</th>
<th style="text-align: right;">stop_lon</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">706325</td>
<td style="text-align: left;">Parada 14 Bis B/C</td>
<td style="text-align: left;">Viad. Dr. Plínio De Queiroz, 901</td>
<td style="text-align: right;">-23.55593</td>
<td style="text-align: right;">-46.65011</td>
</tr>
<tr class="even">
<td style="text-align: left;">810602</td>
<td style="text-align: left;">R. Sta. Rita, 56</td>
<td style="text-align: left;">Ref.: R. Bresser / R. João Boemer</td>
<td style="text-align: right;">-23.53337</td>
<td style="text-align: right;">-46.61229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">910776</td>
<td style="text-align: left;">Av. Do Estado, 5854</td>
<td style="text-align: left;">Ref.: Rua Dona Ana Néri</td>
<td style="text-align: right;">-23.55896</td>
<td style="text-align: right;">-46.61520</td>
</tr>
<tr class="even">
<td style="text-align: left;">1010092</td>
<td style="text-align: left;">Parada Caetano Pinto</td>
<td style="text-align: left;">Av. Rangel Pestana, 1249 Ref.: Rua Caetano Pinto/rua Prof. Batista De Andrade</td>
<td style="text-align: right;">-23.54615</td>
<td style="text-align: right;">-46.62218</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1010093</td>
<td style="text-align: left;">Parada Piratininga</td>
<td style="text-align: left;">Av. Rangel Pestana, 1479 Ref.: Rua Monsenhor Andrade</td>
<td style="text-align: right;">-23.54509</td>
<td style="text-align: right;">-46.62006</td>
</tr>
<tr class="even">
<td style="text-align: left;">1010099</td>
<td style="text-align: left;">R. Xavantes, 612</td>
<td style="text-align: left;">Ref.: Rua Joli</td>
<td style="text-align: right;">-23.53545</td>
<td style="text-align: right;">-46.61368</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As colunas <code>stop_id</code> e <code>stop_name</code> servem como identificadores de cada parada, porém cumprem papéis distintos. O principal propósito da <code>stop_id</code> é identificar relações entre esta tabela e outras que compõem a especificação (como veremos mais à frente no arquivo <code>stop_times.txt</code>, por exemplo). Já a coluna <code>stop_name</code> cumpre o papel de um identificador facilmente reconhecido pelo passageiro. Seus valores, portanto, costumam ser nomes de estações, nomes de pontos de interesse da cidade ou endereços (como no caso do <em>feed</em> da SPTrans).</p>
<p>A coluna <code>stop_desc</code>, presente no <em>feed</em> da SPTrans, é opcional e permite à agência de transporte adicionar uma descrição de cada parada e de seu entorno. As colunas <code>stop_lat</code> e <code>stop_lon</code>, por fim, são as responsáveis por associar cada parada a uma posição espacial, por meio de suas coordenadas geográficas de latitude e longitude.</p>
<p>Entre as colunas opcionais não presentes no <code>stops.txt</code> deste <em>feed</em> estão a <code>location_type</code> e a <code>parent_station</code>. A <code>location_type</code> é utilizada para denotar o tipo de localização a que cada ponto se refere. Quando ausente, todos os pontos são interpretados como paradas de transporte público, mas valores distintos podem ser usados para distinguir uma parada (<code>location_type = 0</code>) de uma estação (<code>location_type = 1</code>) ou uma área de embarque (<code>location_type = 2</code>), por exemplo. A coluna <code>parent_station</code>, por sua vez, é utilizada para descrever relações de hierarquia entre dois pontos. Por exemplo, uma área de desembarque deve dizer a qual parada/plataforma ela pertence, assim como uma parada/plataforma pode também, opcionalmente, listar a qual estação ela pertence.</p>
</section><section id="routes.txt" class="level3" data-number="4.1.3"><h3 data-number="4.1.3" class="anchored" data-anchor-id="routes.txt">
<span class="header-section-number">4.1.3</span> routes.txt</h3>
<p>Arquivo usado para descrever as linhas de transporte público que rodam no sistema, incluindo os modos de transporte utilizados em cada uma. A <a href="#tbl-routes">Tabela <span>4.3</span></a> mostra o <code>routes.txt</code> do <em>feed</em> da SPTrans.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-routes" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.3: Exemplo de arquivo <code>routes.txt</code>. Fonte: SPTrans</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 22%">
<col style="width: 38%">
<col style="width: 14%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">route_id</th>
<th style="text-align: left;">agency_id</th>
<th style="text-align: left;">route_short_name</th>
<th style="text-align: left;">route_long_name</th>
<th style="text-align: right;">route_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CPTM L07</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">CPTM L07</td>
<td style="text-align: left;">JUNDIAI - LUZ</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L08</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">CPTM L08</td>
<td style="text-align: left;">AMADOR BUENO - JULIO PRESTES</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L09</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">CPTM L09</td>
<td style="text-align: left;">GRAJAU - OSASCO</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L10</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">CPTM L10</td>
<td style="text-align: left;">RIO GRANDE DA SERRA - BRÁS</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L11</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">CPTM L11</td>
<td style="text-align: left;">ESTUDANTES - LUZ</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L12</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">CPTM L12</td>
<td style="text-align: left;">CALMON VIANA - BRAS</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Assim como no caso do arquivo <code>stops.txt</code>, a tabela do <code>routes.txt</code> também possui diferentes colunas que apontam o identificador de cada linha (<code>route_id</code>) e o seu nome. Nesse caso, no entanto, existem duas colunas de nome: a <code>route_short_name</code> e a <code>route_long_name</code>. A primeira diz respeito ao nome da linha, usualmente utilizado por passageiros no dia-a-dia, enquanto o segundo tende a ser um nome mais descritivo. A SPTrans, por exemplo, optou por destacar os pontos finais de cada linha nessa coluna. Podemos notar também que os mesmos valores se repetem nas colunas <code>route_id</code> e <code>route_short_name</code>, o que não é obrigatório nem proibido - nesse caso, o produtor do <em>feed</em> julgou que os nomes das linhas poderiam funcionar satisfatoriamente como identificadores por serem razoavelmente curtos e não se repetirem.</p>
<p>A coluna <code>agency_id</code> é a chave que permite relacionar a tabela das rotas com a tabela descrita no <code>agency.txt</code>. Ela faz menção a uma agência descrita naquele arquivo, a agência de id <code>1</code> (a própria SPTrans). Essa coluna é opcional no caso de <em>feeds</em> em que existe apenas uma agência, porém é obrigatória nos casos em que existe mais de uma. Imaginemos, por exemplo, um <em>feed</em> que descreve um sistema multimodal que conta com um corredor de metrô e diversas linhas de ônibus: uma configuração possível de <code>routes.txt</code> descreveria as linhas de metrô como de responsabilidade da operadora do metrô, e as de ônibus como de responsabilidade da empresa responsável pelo planejamento das linhas de ônibus, por exemplo.</p>
<p>A coluna <code>route_type</code> é utilizada para descrever o modo de transporte utilizado em cada linha. Essa coluna aceita diferentes números, cada um representando um determinado modo. Esse exemplo descreve linhas de trem, cujo valor numérico correspondente é <code>2</code>. Os valores correspondentes para outros modos de transporte são listados na <a href="https://gtfs.org/schedule/reference/#routestxt">especificação</a>.</p>
</section><section id="trips.txt" class="level3" data-number="4.1.4"><h3 data-number="4.1.4" class="anchored" data-anchor-id="trips.txt">
<span class="header-section-number">4.1.4</span> trips.txt</h3>
<p>Arquivo usado para descrever as viagens realizadas no sistema. A viagem é a unidade básica de movimento do formato GTFS: cada viagem é associada a uma linha de transporte público (<code>route_id</code>), a um serviço que opera em determinados dias da semana (como veremos mais à frente, no arquivo <code>calendar.txt</code>) e a uma trajetória espacial (como será mostrado no arquivo <code>shapes.txt</code>). A <a href="#tbl-trips">Tabela <span>4.4</span></a> mostra o <code>trips.txt</code> do <em>feed</em> da SPTrans.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-trips" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.4: Exemplo de arquivo <code>trips.txt</code>. Fonte: SPTrans</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 19%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">trip_id</th>
<th style="text-align: left;">route_id</th>
<th style="text-align: left;">service_id</th>
<th style="text-align: left;">trip_headsign</th>
<th style="text-align: right;">direction_id</th>
<th style="text-align: left;">shape_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">CPTM L07</td>
<td style="text-align: left;">USD</td>
<td style="text-align: left;">JUNDIAI</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">17846</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-1</td>
<td style="text-align: left;">CPTM L07</td>
<td style="text-align: left;">USD</td>
<td style="text-align: left;">LUZ</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">17847</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L08-0</td>
<td style="text-align: left;">CPTM L08</td>
<td style="text-align: left;">USD</td>
<td style="text-align: left;">AMADOR BUENO</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">17848</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L08-1</td>
<td style="text-align: left;">CPTM L08</td>
<td style="text-align: left;">USD</td>
<td style="text-align: left;">JULIO PRESTES</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">17849</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L09-0</td>
<td style="text-align: left;">CPTM L09</td>
<td style="text-align: left;">USD</td>
<td style="text-align: left;">GRAJAU</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">17850</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L09-1</td>
<td style="text-align: left;">CPTM L09</td>
<td style="text-align: left;">USD</td>
<td style="text-align: left;">OSASCO</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">17851</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A coluna <code>trip_id</code> identifica cada uma das viagens descritas na tabela, assim como a <code>route_id</code> faz referência a uma linha de transporte público identificada no arquivo <code>routes.txt</code>. A coluna <code>service_id</code> identifica serviços que determinam os dias da semana em que cada uma das viagens opera (dias úteis, finais de semana, uma mistura dos dois etc.), descritos detalhadamente no arquivo <code>calendar.txt</code>. A última coluna à direita na <a href="#tbl-trips">Tabela <span>4.4</span></a> é a <code>shape_id</code>, que identifica a trajetória espacial de cada uma das viagens, descrita em detalhes no arquivo <code>shapes.txt</code>.</p>
<p>As duas colunas restantes, <code>trip_headsign</code> e <code>direction_id</code>, são opcionais e devem ser utilizadas para descrever o sentido/destino da viagem. A primeira, <code>trip_headsign</code>, é utilizada para ditar o texto que aparece no letreiro de veículos (no caso de um ônibus, por exemplo) ou em painéis informativos (como em metrôs e trens) destacando o destino da viagem. Já a coluna <code>direction_id</code> é frequentemente utilizada em conjunto com a primeira para dar uma conotação de ida ou volta para cada viagem, em que <code>0</code> representa ida e <code>1</code>, volta, ou vice-versa (assim como ida e volta são conceitos que mudam conforme o referencial, os valores <code>0</code> e <code>1</code> podem ser usados como desejado, desde que um represente um sentido e o outro, o contrário). No exemplo, as duas primeiras linhas são viagens que fazem menção à mesma rota de transporte público (<code>CPTM L07</code>), porém em sentidos opostos: uma corre em direção a Jundiaí e a outra, à Luz.</p>
</section><section id="calendar.txt" class="level3" data-number="4.1.5"><h3 data-number="4.1.5" class="anchored" data-anchor-id="calendar.txt">
<span class="header-section-number">4.1.5</span> calendar.txt</h3>
<p>Arquivo usado para descrever os diferentes tipos de serviço existentes no sistema. Um serviço, nesse contexto, denota um conjunto de dias da semana em que viagens são realizadas. Cada serviço também é definido pela data em que começa a valer e pela data a partir da qual ele não é mais válido. A <a href="#tbl-calendar">Tabela <span>4.5</span></a> mostra o <code>calendar.txt</code> do <em>feed</em> da SPTrans.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-calendar" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.5: Exemplo de arquivo <code>calendar.txt</code>. Fonte: SPTrans</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">service_id</th>
<th style="text-align: right;">monday</th>
<th style="text-align: right;">tuesday</th>
<th style="text-align: right;">wednesday</th>
<th style="text-align: right;">thursday</th>
<th style="text-align: right;">friday</th>
<th style="text-align: right;">saturday</th>
<th style="text-align: right;">sunday</th>
<th style="text-align: right;">start_date</th>
<th style="text-align: right;">end_date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">USD</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20200501</td>
</tr>
<tr class="even">
<td style="text-align: left;">U__</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20200501</td>
</tr>
<tr class="odd">
<td style="text-align: left;">US_</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20200501</td>
</tr>
<tr class="even">
<td style="text-align: left;">_SD</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20200501</td>
</tr>
<tr class="odd">
<td style="text-align: left;">__D</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20200501</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>S</em></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20080101</td>
<td style="text-align: right;">20200501</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A coluna <code>service_id</code> identifica cada um dos serviços descritos na tabela. Como mostrado anteriormente, este identificador é usado também no arquivo <code>trips.txt</code> e é o responsável por associar cada viagem a um determinado serviço.</p>
<p>As colunas <code>monday</code>, <code>tuesday</code>, <code>wednesday</code>, <code>thursday</code>, <code>friday</code>, <code>saturday</code> e <code>sunday</code> (segunda-feira a domingo, em inglês) são utilizadas para delimitar os dias em que cada serviço funciona. O valor <code>1</code> significa que o serviço opera naquele dia, enquanto o valor <code>0</code> significa que ele não opera. Como podemos ver na <a href="#tbl-calendar">Tabela <span>4.5</span></a>, o serviço <code>USD</code> opera em todos os dias da semana. Já o serviço <code>U__</code> opera apenas em dias úteis.</p>
<p>Por fim, as colunas <code>start_date</code> e <code>end_date</code> delimitam o intervalo em que cada serviço é válido. As datas do formato GTFS são sempre formatadas segundo a regra <code>YYYYMMDD</code>, em que os primeiros quatro números definem o ano, os dois subsequentes definem o mês e os últimos dois, o dia. O valor <code>20220428</code>, por exemplo, representa o dia 28 de abril de 2022.</p>
</section><section id="shapes.txt" class="level3" data-number="4.1.6"><h3 data-number="4.1.6" class="anchored" data-anchor-id="shapes.txt">
<span class="header-section-number">4.1.6</span> shapes.txt</h3>
<p>Arquivo usado para descrever a trajetória espacial de cada viagem listada no <em>feed</em>. Esse arquivo é opcional, mas é fortemente recomendado que agências de transporte o incluam em seus arquivos GTFS. A <a href="#tbl-shapes">Tabela <span>4.6</span></a> mostra o <code>shapes.txt</code> do <em>feed</em> da SPTrans.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-shapes" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.6: Exemplo de arquivo <code>shapes.txt</code>. Fonte: SPTrans</caption>
<thead><tr class="header">
<th style="text-align: left;">shape_id</th>
<th style="text-align: right;">shape_pt_lat</th>
<th style="text-align: right;">shape_pt_lon</th>
<th style="text-align: right;">shape_pt_sequence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">17846</td>
<td style="text-align: right;">-23.53517</td>
<td style="text-align: right;">-46.63535</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">17846</td>
<td style="text-align: right;">-23.53513</td>
<td style="text-align: right;">-46.63548</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">17846</td>
<td style="text-align: right;">-23.53494</td>
<td style="text-align: right;">-46.63626</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">17846</td>
<td style="text-align: right;">-23.53473</td>
<td style="text-align: right;">-46.63710</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">17846</td>
<td style="text-align: right;">-23.53466</td>
<td style="text-align: right;">-46.63735</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">17846</td>
<td style="text-align: right;">-23.53416</td>
<td style="text-align: right;">-46.63866</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A coluna <code>shape_id</code> identifica cada uma das trajetórias descritas na tabela. Como mostrado anteriormente, esse identificador é usado também no arquivo <code>trips.txt</code> e é o responsável por associar cada viagem à sua trajetória espacial. Diferentemente de todos os outros identificadores que vimos até então, no entanto, o identificador <code>shape_id</code> se repete em diversas observações da tabela. Isso porque o arquivo associa cada <code>shape_id</code> a uma série de pontos espaciais, cujas coordenadas geográficas são descritas nas colunas <code>shape_pt_lat</code> e <code>shape_pt_lon</code>. A coluna <code>shape_pt_sequence</code> lista a sequência na qual os pontos se conectam para formar a trajetória de cada <code>shape_id</code>. Os valores listados nessa coluna devem ser ordenados de forma crescente.</p>
</section><section id="stop_times.txt" class="level3" data-number="4.1.7"><h3 data-number="4.1.7" class="anchored" data-anchor-id="stop_times.txt">
<span class="header-section-number">4.1.7</span> stop_times.txt</h3>
<p>Arquivo usado para descrever a tabela de horários de cada viagem, incluindo o horário de chegada e partida em cada uma das paradas. A formatação desse arquivo depende da existência ou não de um arquivo <code>frequencies.txt</code>, detalhe que cobriremos mais adiante. Por enquanto, olharemos para o <code>stop_times.txt</code> do <em>feed</em> da SPTrans, que também conta com um <code>frequencies.txt</code>, na <a href="#tbl-stop_times">Tabela <span>4.7</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-stop_times" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.7: Exemplo de arquivo <code>stop_times.txt</code>. Fonte: SPTrans</caption>
<thead><tr class="header">
<th style="text-align: left;">trip_id</th>
<th style="text-align: left;">arrival_time</th>
<th style="text-align: left;">departure_time</th>
<th style="text-align: left;">stop_id</th>
<th style="text-align: right;">stop_sequence</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:00:00</td>
<td style="text-align: left;">04:00:00</td>
<td style="text-align: left;">18940</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:08:00</td>
<td style="text-align: left;">04:08:00</td>
<td style="text-align: left;">18920</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:16:00</td>
<td style="text-align: left;">04:16:00</td>
<td style="text-align: left;">18919</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:24:00</td>
<td style="text-align: left;">04:24:00</td>
<td style="text-align: left;">18917</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:32:00</td>
<td style="text-align: left;">04:32:00</td>
<td style="text-align: left;">18916</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:40:00</td>
<td style="text-align: left;">04:40:00</td>
<td style="text-align: left;">18965</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A viagem cuja tabela de horários está sendo descrita é identificada pela coluna <code>trip_id</code>. De forma análoga ao que acontece na tabela de trajetórias, um mesmo <code>trip_id</code> se repete em muitas observações da tabela. Isso porque, assim como a trajetória é composta por uma sequência de pontos espaciais, a tabela de horários é composta por uma sequência de diversos horários de partida/chegada em diversas paradas de transporte público.</p>
<p>As colunas seguintes, <code>arrival_time</code>, <code>departure_time</code> e <code>stop_id</code>, são as responsáveis por descrever o cronograma de cada viagem, associando um horário de chegada e um horário de partida a cada uma das paradas da viagem. As colunas de horário são formatadas segundo a regra <code>HH:MM:SS</code>, em que os dois primeiros números definem a hora, os dois seguintes, os minutos e os últimos dois, os segundos. Essa formatação aceita valores de hora maiores que <code>24</code>: por exemplo, se uma viagem parte às 23h, mas só chega a uma determinada estação 1h da manhã do dia seguinte, seu horário de chegada deve ser registrado como <code>25:00:00</code>, e não <code>01:00:00</code>. A coluna <code>stop_id</code>, por sua vez, associa os horários de chegada e partida a uma parada descrita no arquivo <code>stops.txt</code>. Por fim, a coluna <code>stop_sequence</code> lista a sequência na qual cada parada se conecta às demais para formar o cronograma da viagem. Seus valores devem ser sempre ordenados de forma crescente.</p>
<p>Vale destacar aqui a diferença entre os arquivos <code>shapes.txt</code> e <code>stop_times.txt</code>. Embora os dois descrevam uma viagem espacialmente, eles o fazem de forma diferente. O <code>stop_times.txt</code> descreve a sequência de paradas e horários que compõem um cronograma, mas nada diz sobre o trajeto percorrido pelo veículo entre cada uma das paradas. Já o <code>shapes.txt</code> traz a trajetória detalhada da viagem como um todo, mas não descreve em que ponto do espaço estão as paradas da viagem. Quando usamos os dois arquivos em conjunto, portanto, sabemos tanto o cronograma de cada viagem quanto a trajetória espacial da viagem entre paradas.</p>
</section><section id="frequencies.txt" class="level3" data-number="4.1.8"><h3 data-number="4.1.8" class="anchored" data-anchor-id="frequencies.txt">
<span class="header-section-number">4.1.8</span> frequencies.txt</h3>
<p>Arquivo opcional usado para descrever a frequência de cada viagem dentro de um determinado período do dia. A <a href="#tbl-frequencies">Tabela <span>4.8</span></a> mostra o <code>frequencies.txt</code> do <em>feed</em> da SPTrans.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-frequencies" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.8: Exemplo de arquivo <code>frequencies.txt</code>. Fonte: SPTrans</caption>
<thead><tr class="header">
<th style="text-align: left;">trip_id</th>
<th style="text-align: left;">start_time</th>
<th style="text-align: left;">end_time</th>
<th style="text-align: right;">headway_secs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">04:00:00</td>
<td style="text-align: left;">04:59:00</td>
<td style="text-align: right;">720</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">05:00:00</td>
<td style="text-align: left;">05:59:00</td>
<td style="text-align: right;">360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">06:00:00</td>
<td style="text-align: left;">06:59:00</td>
<td style="text-align: right;">360</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">07:00:00</td>
<td style="text-align: left;">07:59:00</td>
<td style="text-align: right;">360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">08:00:00</td>
<td style="text-align: left;">08:59:00</td>
<td style="text-align: right;">360</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPTM L07-0</td>
<td style="text-align: left;">09:00:00</td>
<td style="text-align: left;">09:59:00</td>
<td style="text-align: right;">480</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A viagem cuja frequência está sendo descrita é identificada pela coluna <code>trip_id</code>. Novamente, um mesmo identificador pode aparecer em várias observações da tabela, pois a especificação prevê que uma mesma viagem pode ter frequências diferentes ao longo do dia (como em horários de pico e fora-pico, por exemplo). Assim, cada linha da tabela se refere à frequência de uma determinada viagem dentro de um intervalo de tempo especificado pelas colunas <code>start_time</code> e <code>end_time</code>.</p>
<p>Dentro do período especificado por essas duas colunas, a viagem possui um <em>headway</em> detalhado na coluna <code>headway_secs</code>. O <em>headway</em> é o tempo que separa a passagem de dois veículos que operam a mesma linha de transporte público. No caso desse arquivo, esse tempo deve ser especificado em segundos. Um valor de <code>720</code> entre 4h e 5h, portanto, significa que a viagem <code>CPTM L07-0</code> ocorre de doze em doze minutos dentro desse período.</p>
<p><strong>Usando as tabelas <code>frequencies.txt</code> e <code>stop_times.txt</code> conjuntamente</strong></p>
<p>É importante entender, agora, como a presença da tabela <code>frequencies.txt</code> altera a especificação da tabela <code>stop_times.txt</code>. Como podemos ver no exemplo da tabela <code>stop_times.txt</code> (<a href="#tbl-stop_times">Tabela <span>4.7</span></a>), a viagem <code>CPTM L07-0</code> parte da primeira parada às 4h e chega na segunda às 4h08. O cronograma de chegada e saída de uma mesma parada de uma viagem, no entanto, não pode ser definido mais de uma vez na tabela. Como então definir o cronograma das viagens que partem às 4h12, 4h24, 4h36 etc. (lembrando que o <em>headway</em> dessa viagem é de doze minutos)?</p>
<p>No caso em que a frequência de uma viagem é especificada no <code>frequencies.txt</code>, o cronograma (a tabela de horários) de uma viagem definido no <code>stop_times.txt</code> deve ser entendido como uma referência que descreve o tempo entre paradas. Isto é, os horários ali definidos não devem ser interpretados à risca. Por exemplo, o cronograma listado estabelece que o tempo de viagem entre a primeira e a segunda parada é de oito minutos, e o tempo entre a segunda e a terceira também. Ou seja, a viagem que parte da primeira parada às 4h00 chega na segunda às 4h08, e na terceira às 4h16. A próxima viagem, que parte da primeira parada às 4h12, por sua vez, chega na segunda parada às 4h20, e na terceira às 4h28.</p>
<p>Entretanto, poderíamos descrever as mesmas viagens no <code>stop_times.txt</code> sem fazer uso do arquivo <code>frequencies.txt</code>. Para isso, poderíamos adicionar um sufixo que identificasse cada uma das viagens referentes à linha <code>CPTM L07</code> no sentido <code>0</code> ao longo do dia. A viagem (<code>trip_id</code>) com identificador <code>CPTM L07-0_1</code>, por exemplo, seria a primeira viagem no sentido <code>0</code> do dia e partiria da primeira parada às 4h e chegaria na segunda às 4h08. A viagem <code>CPTM L07-0_2</code>, por sua vez, seria a segunda viagem e partiria da primeira parada às 4h12 e chegaria na segunda às 4h20, e assim por diante. Cada uma dessas viagens deveria ser também adicionada ao arquivo <code>trips.txt</code> e a quaisquer outros que possuam a coluna <code>trip_id</code> como identificador.</p>
<p>Outro elemento que influencia na forma como o <code>frequencies.txt</code> afeta as tabelas de horários na tabela <code>stop_times.txt</code> é a coluna opcional <code>exact_times</code>. Um valor de <code>0</code> nesta coluna (ou quando ela está ausente do <em>feed</em>, como no caso do arquivo GTFS da SPTrans) indica que a viagem não necessariamente segue um cronograma fixo ao longo do período. Em vez disso, operadores tentam se ater a um determinado <em>headway</em> durante o período. Usando o mesmo exemplo de uma viagem cujo <em>headway</em> é de doze minutos entre 4h e 5h, isso significa que não necessariamente a primeira partida sairá exatamente às 4h, a segunda às 4h12 e por aí em diante. A primeira pode, por exemplo, sair às 4h02. A segunda, às 4h14 ou 4h13 etc. Caso desejemos definir um cronograma que é seguido à risca, obtendo o mesmo resultado que seria obtido se definíssemos diversas viagens semelhantes partindo em diferentes horários no <code>stop_times.txt</code> (como mostrado no parágrafo anterior), devemos utilizar o valor <code>1</code> na coluna <code>exact_times</code>.</p>
</section></section><section id="onde-encontrar-dados-gtfs-de-cidades-brasileiras" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="onde-encontrar-dados-gtfs-de-cidades-brasileiras">
<span class="header-section-number">4.2</span> Onde encontrar dados GTFS de cidades brasileiras</h2>
<p>Os dados de GTFS de diversas cidades do mundo podem ser baixados com o pacote de R <a href="https://r-transit.github.io/tidytransit/"><code>{tidytransit}</code></a> ou no <em>site</em> <a href="https://www.transit.land/">Transitland</a>. No Brasil, diversas cidades usam dados GTFS no planejamento e operação de seus sistemas de transportes. Em muitos casos, no entanto, esses dados são de propriedade de empresas operadoras e concessionárias, e não do poder público. Infelizmente, esses arquivos raramente são disponibilizados aberta e publicamente, contrariando boas práticas de gestão e compartilhamento de dados de interesse público. A <a href="#tbl-gtfs_brasil">Tabela <span>4.9</span></a> mostra as fontes dos dados GTFS de algumas das poucas cidades do Brasil que disponibilizam seus <em>feeds</em> abertamente<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-gtfs_brasil" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabela 4.9: Fontes de dados GTFS publicamente disponíveis no Brasil</caption>
<thead><tr class="header">
<th style="text-align: left;">Cidade</th>
<th style="text-align: left;">Fonte</th>
<th style="text-align: left;">Informações</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Belo Horizonte</td>
<td style="text-align: left;">Empresa de Transportes e Trânsito de Belo Horizonte (BHTrans)</td>
<td style="text-align: left;">Dado aberto: <a href="https://dados.pbh.gov.br/dataset/gtfs-estatico-do-sistema-convencional">transporte convencional</a>; <a href="https://dados.pbh.gov.br/dataset/feed-gtfs-estatico-do-sistema-suplementar">transporte suplementar</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fortaleza</td>
<td style="text-align: left;">Empresa de Transporte Urbano de Fortaleza (Etufor)</td>
<td style="text-align: left;">
<a href="https://dados.fortaleza.ce.gov.br/dataset/gtfs">Dado aberto</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fortaleza</td>
<td style="text-align: left;">Metrô de Fortaleza (Metrofor)</td>
<td style="text-align: left;">
<a href="https://www.metrofor.ce.gov.br/gtfs/">Dado aberto</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Porto Alegre</td>
<td style="text-align: left;">Empresa Pública de Transporte e Circulação de Porto Alegre (EPTC)</td>
<td style="text-align: left;">
<a href="https://dados.portoalegre.rs.gov.br/dataset/gtfs">Dado aberto</a>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rio de Janeiro</td>
<td style="text-align: left;">Secretaria Municipal de Transportes (SMTR)</td>
<td style="text-align: left;">
<a href="https://www.data.rio/datasets/gtfs-do-rio-de-janeiro/about">Dado aberto</a>.</td>
</tr>
<tr class="even">
<td style="text-align: left;">São Paulo</td>
<td style="text-align: left;">Empresa Metropolitana de Transportes Urbanos de São Paulo (EMTU)</td>
<td style="text-align: left;">Download <a href="https://www.emtu.sp.gov.br/emtu/dados-abertos/dados-abertos-principal/gtfs.fss">neste link</a>. Necessário cadastro.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">São Paulo</td>
<td style="text-align: left;">SPTrans</td>
<td style="text-align: left;">Download <a href="https://www.sptrans.com.br/desenvolvedores/">neste link</a>. Necessário cadastro.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Obs.: Os dados de GTFS disponibilizados pela SMTR não incluem os dados dos sistemas de trem e de metrô.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-mchugh2013pioneering" class="csl-entry" role="listitem">
McHugh, Bibiana. 2013. <span>«Pioneering <span>Open Data Standards</span>: <span>The GTFS Story</span>»</span>. Em <em>Beyond <span>Transparency</span>: <span>Open Data</span> and the <span>Future</span> of <span>Civic Innovation</span></em>, editado por Brett Goldstein e Lauren Dyson, First, 125–35. <span>San Francisco, CA</span>: <span>Code for America Press</span>.
</div>
<div id="ref-pereira2022exploringa" class="csl-entry" role="listitem">
Pereira, Rafael H. M., Pedro R. Andrade, e João Pedro Bazzo Vieira. 2022. <span>«Exploring the Time Geography of Public Transport Networks with the Gtfs2gps Package»</span>. <em>Journal of Geographical Systems</em>, dezembro. <a href="https://doi.org/10.1007/s10109-022-00400-x">https://doi.org/10.1007/s10109-022-00400-x</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Mais informações sobre o formato GTFS <em>Realtime</em> disponíveis em <a href="https://gtfs.org/realtime/" class="uri">https://gtfs.org/realtime/</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Neste livro, utilizaremos os termos <em>feed</em>, arquivo GTFS e dados GTFS como sinônimos.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Conforme a <a href="https://gtfs.org/schedule/reference/">especificação oficial</a>, versão da revisão 9 de maio de 2022.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Para mais informações sobre as tabelas e as colunas não abordadas neste texto, pode-se verificar a <a href="https://gtfs.org/schedule/reference/">especificação oficial</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Disponível em <a href="https://www.sptrans.com.br/desenvolvedores/" class="uri">https://www.sptrans.com.br/desenvolvedores/</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Levantamento realizado durante a elaboração deste livro.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./s3_dados_tp.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">SEÇÃO 3: Dados de transporte público</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./5_gtfstools.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>  <span class="chapter-title">Manipulação e visualização de dados GTFS</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Ipea - Instituto de Pesquisa Econômica Aplicada</div>   
    <div class="nav-footer-center">
       
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/ipeaGIT/intro_access_book" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>
</body>
</html>
